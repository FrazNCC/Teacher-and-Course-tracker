<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Teacher and Course Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  background: linear-gradient(115deg,#ecf0fa 0%, #e0eaff 95%);
  font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
  margin:0; padding:0;
}
.header {
  text-align: center;
  padding: 30px 0 18px 0;
  font-size: 2.2em;
  font-weight: 700;
  letter-spacing: 1px;
  color: #1a2036;
}

.main-nav {
  display: flex; justify-content: center; flex-wrap: wrap; gap: 32px;
  margin: 32px 0;
}

.tile-btn {
  flex: 1 1 180px;
  border-radius: 24px;
  padding: 48px 32px;
  background: linear-gradient(120deg, #667eea 0%, #91eae4 100%);
  color: #fff;
  box-shadow: 0 8px 30px rgba(67,107,251,0.10), 0 0 0 1px #eaecef;
  margin: 18px;
  font-size: 1.35em;
  font-weight: 600;
  text-align: center;
  cursor: pointer;
  transition: box-shadow .18s, background .2s;
  border: none;
}
.tile-btn:hover {
  box-shadow: 0 8px 30px rgba(67,107,251,0.20), 0 0 0 2px #667eea;
  background: linear-gradient(120deg, #667eea 0%, #764ba2 100%);
}

.section {
  max-width: 900px;
  margin: 0 auto 40px auto;
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(36,55,120,0.04);
  padding: 32px 28px 22px 28px;
  display: none;
}

.section.active { display: block; }

h2 {
  font-size: 1.4em; color: #667eea;
  font-weight: 700;
}

.form-inline {
  display: flex; gap: 18px; margin-bottom: 18px;
}
input, select {
  padding: 8px 14px; border-radius: 6px; border:1px solid #dde;
  font-size: 1em; background: #f9fbfe; color: #444;
}
.btn {
  background: #667eea;
  color: #fff;
  border-radius: 8px;
  border: none; font-weight: 600;
  padding: 8px 20px; cursor: pointer;
}
.btn:hover { background: #764ba2; }
.table {
  width: 100%; border-collapse: collapse; margin-bottom:22px;
}
.table th, .table td {
  border-bottom: 1px solid #eaecef;
  padding: 10px 8px;
  text-align: left;
}
.table th { background: #f1f8ff; font-weight: bold; }
.table td input { width: 52px; }

.status-green { background:#e7fbe7; }
.status-amber { background:#fffae3; }
.status-red { background:#ffeaea; }
.filter-bar { margin-bottom: 18px; display: flex; gap:24px; }

@media(max-width:600px) {
  .main-nav { flex-direction: column; gap:18px;}
  .tile-btn { padding:40px 16px; font-size: 1em; }
  .section { padding:16px 6px 12px 6px;}
}
</style>
</head>
<body>
  <div class="header">Teacher and Course Tracker</div>
  <div class="main-nav">
    <button class="tile-btn" id="btn-teachers">Manage Teachers</button>
    <button class="tile-btn" id="btn-courses">Manage Courses</button>
    <button class="tile-btn" id="btn-course-tracker">Course Tracker</button>
    <button class="tile-btn" id="btn-teacher-tracker">Teacher Tracker</button>
  </div>
  
  <!-- Teachers Section -->
  <div class="section" id="section-teachers">
    <h2>Teachers</h2>
    <form class="form-inline" id="teacherForm">
      <input type="text" id="teacherName" placeholder="Name/Initials" required>
      <input type="number" id="teacherHours" placeholder="Teaching Hours" min="0" required>
      <select multiple id="teacherCourses"></select>
      <button class="btn" type="submit">Add Teacher</button>
    </form>
    <div class="filter-bar">
      <label>Filter By Course:
        <select id="filterTeacherCourse"></select>
      </label>
    </div>
    <table class="table" id="teacherTable">
      <thead><tr><th>Name</th><th>Hrs</th><th>Courses</th><th>Edit</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
  
  <!-- Courses Section -->
  <div class="section" id="section-courses">
    <h2>Courses</h2>
    <form class="form-inline" id="courseForm">
      <input type="text" id="courseName" placeholder="Course Name" required>
      <input type="number" id="courseTarget" placeholder="Target Hours" min="0">
      <button class="btn" type="submit">Add Course</button>
    </form>
    <div class="filter-bar">
      <label>Filter By Teacher:
        <select id="filterCourseTeacher"></select>
      </label>
    </div>
    <table class="table" id="courseTable">
      <thead><tr><th>Name</th><th>Target</th><th>Teachers</th><th>Edit</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
  
  <!-- Course Tracker Section -->
  <div class="section" id="section-course-tracker">
    <h2>Course Tracker</h2>
    <div class="filter-bar" id="courseTrackerFilters">
      <label>Year: <select id="trackerYear"></select></label>
      <label>Course: <select id="trackerCourse"></select></label>
      <label>Status: 
        <select id="trackerStatus">
          <option value="">All</option>
          <option value="ok">OK (green)</option>
          <option value="extra">Extra (amber)</option>
          <option value="over">Over (red)</option>
        </select>
      </label>
    </div>
    <div id="courseTrackerGrid"></div>
  </div>
  
  <!-- Teacher Tracker Section -->
  <div class="section" id="section-teacher-tracker">
    <h2>Teacher Tracker</h2>
    <div class="filter-bar" id="teacherTrackerFilters">
      <label>Teacher: <select id="teacherTrackerTeacher"></select></label>
      <label>Course: <select id="teacherTrackerCourse"></select></label>
    </div>
    <div id="teacherTrackerGrid"></div>
  </div>
  
<script>
/* Core state */
let teachers=[], courses=[], planning={}, currentYear=(new Date().getFullYear());

function saveData() {
  localStorage.setItem("tct_teachers",JSON.stringify(teachers));
  localStorage.setItem("tct_courses",JSON.stringify(courses));
  localStorage.setItem("tct_planning",JSON.stringify(planning));
}
function loadData() {
  teachers=JSON.parse(localStorage.getItem("tct_teachers")||"[]");
  courses=JSON.parse(localStorage.getItem("tct_courses")||"[]");
  planning=JSON.parse(localStorage.getItem("tct_planning")||"{}");
}
function refreshAll() {
  renderTeachers();
  renderCourses();
  renderCourseTracker();
  renderTeacherTracker();
  updateFilters();
}

/* Tile navigation */
function switchSection(sectionId){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove("active"));
  document.getElementById(sectionId).classList.add("active");
}
document.getElementById("btn-teachers").onclick=()=>switchSection("section-teachers");
document.getElementById("btn-courses").onclick=()=>switchSection("section-courses");
document.getElementById("btn-course-tracker").onclick=()=>switchSection("section-course-tracker");
document.getElementById("btn-teacher-tracker").onclick=()=>switchSection("section-teacher-tracker");

/* Teachers CRUD */
document.getElementById("teacherForm").onsubmit=function(e){
  e.preventDefault();
  let selectedCourses=Array.from(teacherCourses.selectedOptions).map(o=>o.value);
  teachers.push({
    id:Date.now(), name:teacherName.value, hours:parseFloat(teacherHours.value), courses:selectedCourses
  });
  saveData(); refreshAll();
  teacherName.value="";teacherHours.value="";teacherCourses.selectedIndex=-1;
};
function renderTeachers(){
  let courseFilter = filterTeacherCourse.value;
  let tb=document.querySelector("#teacherTable tbody");tb.innerHTML="";
  teachers.filter(t=>
    !courseFilter||t.courses.includes(courseFilter)
  ).forEach(t=>{
    let courseNames=t.courses.map(cid=>
      courses.find(c=>c.id==cid)?.name||""
    ).join(", ");
    let row=`<tr>
      <td>${t.name}</td>
      <td>${t.hours}</td>
      <td>${courseNames}</td>
      <td>
        <button class="btn" onclick="editTeacher(${t.id})">Edit</button>
      </td>
    </tr>`;
    tb.innerHTML+=row;
  });
  fillMultiSelect(teacherCourses, courses, "id", "name");
}
window.editTeacher=function(id){
  let t=teachers.find(x=>x.id==id); if(!t)return;
  teacherName.value=t.name; teacherHours.value=t.hours; 
  fillMultiSelect(teacherCourses, courses, "id", "name", t.courses);
  // Remove and re-add on next submit
  teachers=teachers.filter(x=>x.id!=id);
  saveData();refreshAll();
}

/* Courses CRUD */
document.getElementById("courseForm").onsubmit=function(e){
  e.preventDefault();
  courses.push({
    id:Date.now(), name:courseName.value, target:parseFloat(courseTarget.value)
  });
  saveData(); refreshAll();
  courseName.value=""; courseTarget.value="";
};
function renderCourses(){
  let teacherFilter = filterCourseTeacher.value;
  let tb=document.querySelector("#courseTable tbody");tb.innerHTML="";
  courses.filter(c=>
    !teacherFilter||teachers.some(t=>t.courses.includes(c.id+"")&&t.id==teacherFilter)
  ).forEach(c=>{
    let teacherNames = teachers.filter(t=>t.courses.includes(c.id+""))
      .map(t=>t.name).join(", ");
    let row=`<tr>
      <td>${c.name}</td>
      <td>${c.target||0}</td>
      <td>${teacherNames}</td>
      <td>
        <button class="btn" onclick="editCourse(${c.id})">Edit</button>
      </td>
    </tr>`;
    tb.innerHTML+=row;
  });
}
window.editCourse=function(id){
  let c=courses.find(x=>x.id==id); if(!c)return;
  courseName.value=c.name; courseTarget.value=c.target||"";
  courses=courses.filter(x=>x.id!=id);
  saveData();refreshAll();
}

/* Course Tracker */
function renderCourseTracker(){
  // Filters
  let year = trackerYear.value||currentYear;
  let courseId = trackerCourse.value;
  let status = trackerStatus.value;
  // Table
  let html=`<table class="table"><thead>
      <tr>
        <th>Course</th>
        <th>Teacher</th>
        <th>Allocated</th>
        <th>Left</th>
        <th>Status</th>
      </tr></thead><tbody>`;
  courses.filter(c=>!courseId||c.id==courseId).forEach(c=>{
    teachers.forEach(t=>{
      if(!t.courses.includes(c.id+"")) return;
      let alloc = (planning[c.id+"-"+t.id+"-"+year]||0);
      let left = (c.target||0)-alloc;
      let st=""; let stLabel="";
      if(left==0){st="status-green";stLabel="OK";}
      else if(left>0){st="status-amber";stLabel="Extra";}
      else {st="status-red";stLabel="Over";}
      if(status && 
        ((status=="ok"&&left!=0)||
         (status=="extra"&&left<=0)||
         (status=="over"&&left>=0))) return;
      html+=`
      <tr>
        <td>${c.name}</td>
        <td>${t.name}</td>
        <td><input type="number" value="${alloc}" min="0" style="width:50px"
         onchange="updatePlanning('${c.id}','${t.id}','${year}',this.value)">
        </td>
        <td>${left}</td>
        <td class="${st}">${stLabel}</td>
      </tr>`;
    });
  });
  html+="</tbody></table>";
  courseTrackerGrid.innerHTML=html;
}
window.updatePlanning=function(cId,tId,year,val){
  planning[cId+"-"+tId+"-"+year]=parseFloat(val)||0;
  saveData();refreshAll();
}

/* Teacher Tracker */
function renderTeacherTracker(){
  let teacherId = teacherTrackerTeacher.value;
  let courseId = teacherTrackerCourse.value;
  let html=`<table class="table"><thead>
    <tr>
      <th>Teacher</th>
      <th>Allocated Courses</th>
      <th>Total Hours</th>
      <th>Status</th>
    </tr></thead><tbody>`;
  teachers.filter(t=>!teacherId||t.id==teacherId).forEach(t=>{
    let tCourses = courses.filter(c=>t.courses.includes(c.id+""));
    let totalAlloc=0, totalTarget=0;
    let courseNames=[];
    tCourses.filter(c=>!courseId||c.id==courseId).forEach(c=>{
      let alloc = (planning[c.id+"-"+t.id+"-"+(currentYear)]||0);
      totalAlloc+=alloc;
      totalTarget+=(c.target||0);
      courseNames.push(`${c.name} (${alloc} hrs)`);
    });
    let left = totalTarget-totalAlloc;
    let st = left==0?"status-green":left>0?"status-amber":"status-red";
    let stLabel = left==0?"OK":left>0?"Extra":"Over";
    html+=`<tr>
      <td>${t.name}</td>
      <td>${courseNames.join(", ")||"-"}</td>
      <td>${totalAlloc}/${totalTarget}</td>
      <td class="${st}">${stLabel}</td>
    </tr>`;
  });
  html+="</tbody></table>";
  teacherTrackerGrid.innerHTML=html;
}

/* Util: Fill Dropdowns/Multi-select */
function fillMultiSelect(sel, data, valKey, textKey, selected){
  sel.innerHTML="";
  data.forEach(d=>{
    let o=document.createElement("option");
    o.value=d[valKey]; o.textContent=d[textKey];
    if(selected&&selected.includes(d[valKey]+"")) o.selected=true;
    sel.appendChild(o);
  });
}

/* Filters setup */
function updateFilters(){
  // Courses for teacher filter
  fillMultiSelect(filterTeacherCourse, courses, "id", "name");
  filterTeacherCourse.onchange=refreshAll;
  // Teachers for course filter
  fillMultiSelect(filterCourseTeacher, teachers, "id", "name");
  filterCourseTeacher.onchange=refreshAll;
  // Years for tracker
  trackerYear.innerHTML="";
  for(let y=currentYear-2;y<=currentYear+2;y++){
    let opt=document.createElement("option");
    opt.value=y; opt.textContent=y;
    if(y==currentYear) opt.selected=true;
    trackerYear.appendChild(opt);
  }
  trackerYear.onchange=refreshAll;
  // Courses for tracker
  fillMultiSelect(trackerCourse, courses, "id", "name");
  trackerCourse.onchange=refreshAll;
  trackerStatus.onchange=refreshAll;
  // Teachers for teacher tracker
  fillMultiSelect(teacherTrackerTeacher, teachers, "id", "name");
  teacherTrackerTeacher.onchange=refreshAll;
  // Courses for teacher tracker
  fillMultiSelect(teacherTrackerCourse, courses, "id", "name");
  teacherTrackerCourse.onchange=refreshAll;
}

/* INIT */
loadData();refreshAll();
switchSection("section-teachers");
</script>
</body>
</html>
